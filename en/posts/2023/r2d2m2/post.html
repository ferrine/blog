

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>The R2D2M2 Prior, the Awwwesome Linear Regression &#8212; In Search of the Holy Posterior</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../../../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../../../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/nbsphinx-code-cells.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/light/default.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/dark/default.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/font/text/font.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/font/text/finlandica.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/font/text/noto-emoji.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/font/text/noto-serif.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/font/code/font.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/css/custom.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/sphinx_highlight.js"></script>
    <script src="../../../_static/design-tabs.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'posts/2023/r2d2m2/post';</script>
    <script src="../../../_static/require-2.3.6.min.js"></script>
    <script src="../../../_static/embed-amd-1.0.1.min.js"></script>
    <link rel="icon" href="../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />

<!-- Yandex.Metrika counter -->
<script type="text/javascript" >
    (function(m,e,t,r,i,k,a){m[i]=m[i]||function(){(m[i].a=m[i].a||[]).push(arguments)};
    m[i].l=1*new Date();
    for (var j = 0; j < document.scripts.length; j++) {if (document.scripts[j].src === r) { return; }}
    k=e.createElement(t),a=e.getElementsByTagName(t)[0],k.async=1,k.src=r,a.parentNode.insertBefore(k,a)})
    (window, document, "script", "https://mc.yandex.ru/metrika/tag.js", "ym");

    ym(94179175, "init", {
         clickmap:true,
         trackLinks:true,
         accurateTrackBounce:true,
         webvisor:true
    });
 </script>
 <noscript><div><img src="https://mc.yandex.ru/watch/94179175" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
 <!-- /Yandex.Metrika counter -->

  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>




  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../../../index.html">
  
  
  
  
  
    <p class="title logo__title">In Search of the Holy Posterior</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../contacts.html">
                        Contacts
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../teaching.html">
                        Teaching
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../blog.html">
                        Blog
                      </a>
                    </li>
                
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
        <div class="navbar-item"><div class="dropdown">
    <a class="dropdown-toggle nav-link" data-bs-toggle="dropdown" aria-expanded="false">
        EN
    </a>
    <ul class="dropdown-menu dropdown-menu-right center" style="min-width: 100%">
        
            
        
    </ul>
</div></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../contacts.html">
                        Contacts
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../teaching.html">
                        Teaching
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../../../blog.html">
                        Blog
                      </a>
                    </li>
                
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
          <div class="navbar-item"><div class="dropdown">
    <a class="dropdown-toggle nav-link" data-bs-toggle="dropdown" aria-expanded="false">
        EN
    </a>
    <ul class="dropdown-menu dropdown-menu-right center" style="min-width: 100%">
        
            
        
    </ul>
</div></div>
        
      </div>
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
<div class="ablog-sidebar-item ablog__postcard">


<h2>
  
  
  <i class="fa fa-calendar"></i>
  
  01 February 2023
  
</h2>
<ul>
  

<li id="ablog-sidebar-item author ablog__author">
  <span>
    
    <i class="fa-fw fa fa-user"></i>
    
    </span>
  
  
  <a href="../../../blog/author/max-kochurov.html">Max Kochurov</a>
  
  
  
</li>



<li id="ablog-sidebar-item language ablog__language">
  <span>
    
    <i class="fa-fw fa fa-language"></i>
    
    </span>
  
  
  <a href="../../../blog/language/english.html">English</a>
  
  
  
</li>


<li id="ablog-sidebar-item category ablog__category">
  <span>
    
    <i class="fa-fw fa fa-folder-open"></i>
    
    </span>
  
  
  <a href="../../../blog/category/post.html">Post</a>
  
  
  
</li>


<li id="ablog-sidebar-item tags ablog__tags">
  <span>
    
    
    <i class="fa-fw fa fa-tags"></i>
    
    
    </span>
  
  
  <a href="../../../blog/tag/pymc.html">pymc</a>
  
  
  
  
  
  <a href="../../../blog/tag/linear-regression.html">linear-regression</a>
  
  
  
  
  
  <a href="../../../blog/tag/prior.html">prior</a>
  
  
  
  
  
  <a href="../../../blog/tag/statistics.html">statistics</a>
  
  
  
</li>


</ul>
</div>
</div>
        <div class="sidebar-primary-item">
<div class="ablog-sidebar-item ablog__recentposts">
<h3>
  <a href="../../../blog.html">Recent Posts</a>
</h3>
<ul>
  
  
  <li>
    <a href="../../../talks/2023/data-fest/event.html">
      Jun 04, 2023 - Bayes in the Wild
    </a>
  </li>
  
  <li>
    <a href="../../../talks/2023/analyst-days/event.html">
      Apr 21, 2023 - Bayesian AB Testing
    </a>
  </li>
  
  <li>
    <a href="../../../talks/2022/data-elka/event.html">
      Dec 17, 2022 - Bayesian AB Testing
    </a>
  </li>
  
  <li>
    <a href="../../2022/labs-ab-histogram/post.html">
      Aug 12, 2022 - Bayesian inference at scale: Running A/B tests with millions of observations
    </a>
  </li>
  
  <li>
    <a href="../../2022/loo-pit/post.html">
      Feb 01, 2022 - Interpreting LOO-PIT
    </a>
  </li>
  
</ul>
</div>
</div>
        <div class="sidebar-primary-item">
<div class="ablog-sidebar-item ablog__tags">
<h3><a href="../../../blog/tag.html">Tags</a></h3>
<ul class="ablog-cloud">
  
  
  <li class="ablog-cloud ablog-cloud-5">
    <a href="../../../blog/tag/ab-testing.html">ab-testing</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/advanced.html">advanced</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/arviz.html">arviz</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-5">
    <a href="../../../blog/tag/beginner.html">beginner</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/high-level.html">high-level</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/linear-regression.html">linear-regression</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/prior.html">prior</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-3">
    <a href="../../../blog/tag/pymc.html">pymc</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-1">
    <a href="../../../blog/tag/pymc-labs.html">pymc-labs</a>
  </li>
  
  
  
  <li class="ablog-cloud ablog-cloud-5">
    <a href="../../../blog/tag/statistics.html">statistics</a>
  </li>
  
  
</ul>
</div>
</div>
        <div class="sidebar-primary-item">
<div class="ablog-sidebar-item ablog__category">
<h3>
  <a href="../../../blog/category.html">Categories</a>
</h3>
<ul>
  
  
  <li>
    <a href="../../../blog/category/post.html">Post (3)</a>
  </li>
  
  
  
  <li>
    <a href="../../../blog/category/talk.html">Talk (3)</a>
  </li>
  
  
</ul>
</div>
</div>
        <div class="sidebar-primary-item">
<div class="ablog-sidebar-item ablog__archive">
<h3>
  <a href="../../../blog/archive.html">Archives</a>
</h3>
<ul>
  
  
  <li>
    <a href="../../../blog/2023.html">2023 (3)</a>
  </li>
  
  
  
  <li>
    <a href="../../../blog/2022.html">2022 (3)</a>
  </li>
  
  
</ul>
</div>
</div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../../../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">The R2D2M2 Prior, the Awwwesome Linear Regression</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
<section id="The-R2D2M2-Prior,-the-Awwwesome-Linear-Regression">
<h1>The R2D2M2 Prior, the Awwwesome Linear Regression<a class="headerlink" href="#The-R2D2M2-Prior,-the-Awwwesome-Linear-Regression" title="Permalink to this heading">#</a></h1>
<img alt="cover" src="../../../_images/cover2.png" />
<p>There is an awesome paper that puts a simple idea of interpretable linear regression to an absolute. The <a class="reference external" href="https://arxiv.org/abs/2208.07132">Intuitive Joint Priors for Bayesian Linear Multilevel Models: The R2D2M2 prior</a>. The idea resonates with me a lot, since I admire interpretable priors and the ability to describe the model, not an ability to explain.</p>
<p>Explaining the model, you try to interpret parameters that are already present in the model, and you need to put some human-readable explanation of the meaning. It reminds me of the top-down approach, then you introduce parameters as you need them.</p>
<p>Describing the model is the opposite. You start with simple statements that you or your peers both understand. It is usually referred to as the bottom up approach, you start with assumptions you understand and complete the model as you go.</p>
<p>Mastering the latter is the essence of Bayesian modeling. In this sense, the paper is of great interest to me.</p>
<section id="Boston-Housing-Data">
<h2>Boston Housing Data<a class="headerlink" href="#Boston-Housing-Data" title="Permalink to this heading">#</a></h2>
<p>As a benchmark dataset, I took the Boston housing dataset. It has the bare minimum to check the model parametrization. I took the part of the linear regression I really need and ignored varying intercept and varying slope. Here is the full model I’m referring to.</p>
<div class="math notranslate nohighlight">
\[\begin{split}\begin{equation}
    \begin{aligned}
y_n &amp; \sim \mathcal{N} (\mu_n, \sigma^2) \\
\mu_n &amp;= b_{0}+ \sum_{i=1}^p x_{ni} b_{i}+  \sum_{g\in G_0} u_{0 g_{j[n]}  }  + \sum_{i=1}^p x_{ni} \left( \sum_{g \in G_i} u_{i g_{j[n]}} \right) \\
b_{0}&amp; \sim  p(b_{0}) \\
b_i &amp;\sim \mathcal{N} \left(0, \frac{\sigma^2}{\sigma_{x_i}^2}   \phi_i \tau^2\right), \quad
    u_{ig_j} \sim \mathcal{N} \left(0, \frac{\sigma^2}{\sigma_{x_i}^2}   \phi_{ig} \tau^2\right) \\
    \tau^2&amp;= \frac{R^2}{1-R^2}\\
R^2  &amp;\sim \operatorname{Beta}(\mu_{R^2},\varphi_{R^2}), \ \
     \phi \sim \operatorname{Dirichlet} (\alpha), \ \
     \sigma \sim p(\sigma). \\
\end{aligned}
\end{equation}\end{split}\]</div>
<p>Let’s finally get our hands dirty with code!</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">housing</span> <span class="o">=</span> <span class="n">fetch_california_housing</span><span class="p">(</span><span class="n">as_frame</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>It has to be remarked that I advocate normalizing your input data so it has <span class="math notranslate nohighlight">\(\mathbb{E}[X]=0\)</span>, <span class="math notranslate nohighlight">\(\mathbb{V}[X]=1\)</span>. This will save you a lot of time to figure out the right scale for slope parameters. Normalizing the output variable also makes a lot of sense. You may also notice that it is actually a part of the R2D2M2 linear regression parameterization. A rule of thumb is to take care of it one way or another.</p>
<div class="math notranslate nohighlight">
\[b_i \sim \mathcal{N} \left(0, \frac{\sigma^2}{\sigma_{x_i}^2}\right)\]</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Xscaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>We deal with positive outcome, prices. I would also expect the variable effect to have elasticity interpretation. To do so, I apply <code class="docutils literal notranslate"><span class="pre">log</span></code> transformation on positive valued regressors.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">housing</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">housing</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span>
<span class="n">non_negative_variables</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;MedInc&quot;</span><span class="p">,</span>
    <span class="s2">&quot;HouseAge&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AveRooms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AveBedrms&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Population&quot;</span><span class="p">,</span>
    <span class="s2">&quot;AveOccup&quot;</span><span class="p">,</span>
<span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="n">non_negative_variables</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">non_negative_variables</span><span class="p">])</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">X</span> <span class="o">=</span> <span class="n">Xscaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">mean</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">std</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<section id="Non-centered-R2D2M2">
<h3>Non-centered R2D2M2<a class="headerlink" href="#Non-centered-R2D2M2" title="Permalink to this heading">#</a></h3>
<p>Whenever I see a normal distribution with mean and scale, I tend to use non-centered parameterization. I was shocked to see how different it is from the centered case. But before we go to the working examples, let’s see how to make an amazing model miserably fail.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># grade the importance of variables</span>
<span class="c1"># 0 - least important, inf - most important</span>
<span class="c1"># 1 - &quot;I do not know&quot;</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="c1"># Give me the 95% bounds of possible R2 for this linear regression</span>
<span class="c1"># 0 - I do not believe in this makes any sense</span>
<span class="c1"># 1 - I totally believe data perfectly explains the outcome</span>
<span class="n">R2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">))</span> <span class="k">as</span> <span class="n">model_sigma_detached</span><span class="p">:</span>
    <span class="n">R2p</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">find_constrained_prior</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span> <span class="o">*</span><span class="n">R2</span><span class="p">,</span> <span class="n">init_guess</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">R2p</span><span class="p">)</span>
    <span class="c1"># the global R2</span>
    <span class="n">tau2</span> <span class="o">=</span> <span class="n">r2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span>
    <span class="c1"># Local R2 / variable importance</span>
    <span class="n">phi</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
    <span class="c1"># Non-Centered parametrization</span>
    <span class="c1"># Note that we scale the parameters by output std</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;coef_raw&quot;</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">std</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">*</span> <span class="n">tau2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
    <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;coef_norm&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
    <span class="c1"># Parameters on the original data scale</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;coef&quot;</span><span class="p">,</span> <span class="n">beta</span> <span class="o">/</span> <span class="n">Xscaler</span><span class="o">.</span><span class="n">scale_</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
    <span class="c1"># now the likelihood</span>
    <span class="c1"># NOTE: sigma is detached from R2</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
    <span class="n">intercept</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="s2">&quot;intercept&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">std</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">estimate</span> <span class="o">=</span> <span class="n">X</span> <span class="o">@</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">intercept</span>
    <span class="n">nu</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Gamma</span><span class="p">(</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">pm</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">estimate</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">model_sigma_detached</span><span class="p">:</span>
    <span class="n">prior</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample_prior_predictive</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Sampling: [R2, coef_raw, intercept, nu, obs, phi, sigma]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_ppc</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">group</span><span class="o">=</span><span class="s2">&quot;prior&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/posts_2023_r2d2m2_post_18_0.png" class="no-scaled-link" src="../../../_images/posts_2023_r2d2m2_post_18_0.png" style="width: 731px; height: 491px;" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_sigma_detached</span><span class="o">.</span><span class="n">point_logps</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;R2&#39;: 0.16,
 &#39;phi&#39;: -6.03,
 &#39;coef_raw&#39;: -7.35,
 &#39;sigma&#39;: -0.73,
 &#39;intercept&#39;: 0.95,
 &#39;nu&#39;: 0.98,
 &#39;obs&#39;: -17806.69}
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">model_sigma_detached</span><span class="p">:</span>
    <span class="n">trace</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;nutpie&quot;</span><span class="p">)</span>
    <span class="n">trace</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">prior</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
  <progress value='8000' class='' max='8000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [8000/8000 59:51&lt;00:00  Chains in warmup: 0, Divergences: 0]
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_pair</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="s2">&quot;coef_raw&quot;</span><span class="p">,</span> <span class="s2">&quot;R2&quot;</span><span class="p">],</span> <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="s2">&quot;MedInc&quot;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/posts_2023_r2d2m2_post_21_0.png" class="no-scaled-link" src="../../../_images/posts_2023_r2d2m2_post_21_0.png" style="width: 1667px; height: 1115px;" />
</div>
</div>
<p>Yet it has no divergences, the parameter landscape is very complicated.</p>
<ul class="simple">
<li><p>Larger phi discourages large coefficients.</p></li>
<li><p>There is also a banana shape relationship</p></li>
<li><p>Step size should be very different if you are in the center of the banana or on its boundary.</p></li>
<li><p>Total sampling time on my Supermicro is almost 1 hour 🤯</p></li>
</ul>
</section>
<section id="Centered-R2D2M2">
<h3>Centered R2D2M2<a class="headerlink" href="#Centered-R2D2M2" title="Permalink to this heading">#</a></h3>
<p>To my surprise, this model parametrization is 20 times faster than a non-centered variant. Once you download the notebook, you can play around with some parameters below to get the idea of R2D2M2 strong or weak places. Here is the bare minimum of what you should know about the model:</p>
<ul class="simple">
<li><p>You choose R2:</p>
<ul>
<li><p>In econometrics classes, you’ve seen what is R2.</p></li>
<li><p>1 - is a perfect data fit</p></li>
<li><p>0 - total noise and predictors are irrelevant.</p></li>
<li><p>In a Bayesian setup, you do not pick one, you pick possible ones.</p></li>
<li><p>A suggestion is to pick a <span class="math notranslate nohighlight">\(95\%\)</span> range <span class="math notranslate nohighlight">\((R^2_{2.5\%}, R^2_{97.5\%})\)</span>.</p></li>
</ul>
</li>
<li><p>You choose variable importance:</p>
<ul>
<li><p>There are usually many variables in the regression, one you might assume is more important than another.</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha_i\)</span> is the parameter to look into to express the knowledge.</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha_i=1\)</span> is total unawareness of the importance of the variable.</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha_i&lt;1\)</span> tells the model you tend to think the <span class="math notranslate nohighlight">\(i\)</span>’th variable is likely to be not significant.</p></li>
<li><p><span class="math notranslate nohighlight">\(\alpha_i&gt;1\)</span> informs your model not to ignore the variable.</p></li>
<li><p>Extremely large or small <span class="math notranslate nohighlight">\(\alpha_i\)</span> may cause numerical problems or divergences</p>
<ul>
<li><p>0.001 was too small</p></li>
<li><p>200 was too much</p></li>
<li><p>You can explore better reasonable bounds using this notebook</p></li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_non_centered_model_1</span><span class="p">(</span>
    <span class="n">n_irrelevant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="c1"># grade the importance of variables</span>
    <span class="c1"># 0 - least impotant, inf - most important</span>
    <span class="c1"># 1 - &quot;I do not know&quot;</span>
    <span class="n">useful_variables_alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">wasted_variables_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># set irrelevant variables</span>
    <span class="n">Xr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_irrelevant</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_irrelevant</span><span class="p">)))])</span>
    <span class="n">scaling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">Xscaler</span><span class="o">.</span><span class="n">scale_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_irrelevant</span><span class="p">)])</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">useful_variables_alpha</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_irrelevant</span><span class="p">,</span> <span class="n">wasted_variables_alpha</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="c1"># Give me the 95% bounds of possible R2 for this linear regression</span>
    <span class="c1"># 0 - I do not believe in this makes any sense</span>
    <span class="c1"># 1 - I totally believe data perfectly explains the outcome</span>
    <span class="n">R2</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">cols</span><span class="p">))</span> <span class="k">as</span> <span class="n">model_centered_sigma_detached</span><span class="p">:</span>
        <span class="n">R2p</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">find_constrained_prior</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span> <span class="o">*</span><span class="n">R2</span><span class="p">,</span> <span class="n">init_guess</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">R2p</span><span class="p">)</span>
        <span class="n">tau2</span> <span class="o">=</span> <span class="p">(</span><span class="n">r2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r2</span><span class="p">))</span> <span class="o">**</span> <span class="mf">0.5</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span>
            <span class="s2">&quot;coef_norm&quot;</span><span class="p">,</span>
            <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;coef_raw&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">phi</span> <span class="o">*</span> <span class="n">tau2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="n">std</span><span class="p">,</span>
            <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;coef&quot;</span><span class="p">,</span> <span class="n">beta</span> <span class="o">/</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">HalfNormal</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">std</span><span class="p">)</span>
        <span class="n">intercept</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="s2">&quot;intercept&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">std</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">estimate</span> <span class="o">=</span> <span class="n">Xr</span> <span class="o">@</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">intercept</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Gamma</span><span class="p">(</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">estimate</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_centered_sigma_detached</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">create_non_centered_model_1</span><span class="p">()</span> <span class="k">as</span> <span class="n">model_centered_sigma_detached</span><span class="p">:</span>
    <span class="n">trace1</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;nutpie&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
  <progress value='8000' class='' max='8000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [8000/8000 01:13&lt;00:00  Chains in warmup: 0, Divergences: 22]
</div></div>
</div>
<section id="Combining-residual-and-sigma">
<h4>Combining residual and sigma<a class="headerlink" href="#Combining-residual-and-sigma" title="Permalink to this heading">#</a></h4>
<p>Sampling is much faster but there are divergences. Let’s try to combine <span class="math notranslate nohighlight">\(R^2\)</span> and <span class="math notranslate nohighlight">\(\sigma\)</span></p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_non_centered_model_2</span><span class="p">(</span>
    <span class="n">n_irrelevant</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="c1"># grade the importance of variables</span>
    <span class="c1"># 0 - least impotant, inf - most important</span>
    <span class="c1"># 1 - &quot;I do not know&quot;</span>
    <span class="n">useful_variables_alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">wasted_variables_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
<span class="p">):</span>
    <span class="c1"># set irrelevant variables</span>
    <span class="n">Xr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">X</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">n_irrelevant</span><span class="p">)],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_irrelevant</span><span class="p">)))])</span>
    <span class="n">scaling</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">Xscaler</span><span class="o">.</span><span class="n">scale_</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n_irrelevant</span><span class="p">)])</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">useful_variables_alpha</span><span class="p">),</span>
            <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">n_irrelevant</span><span class="p">,</span> <span class="n">wasted_variables_alpha</span><span class="p">),</span>
        <span class="p">]</span>
    <span class="p">)</span>
    <span class="k">with</span> <span class="n">pm</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="n">cols</span><span class="p">))</span> <span class="k">as</span> <span class="n">model_sigma_attached</span><span class="p">:</span>
        <span class="n">R2p</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">find_constrained_prior</span><span class="p">(</span><span class="n">pm</span><span class="o">.</span><span class="n">Beta</span><span class="p">,</span> <span class="o">*</span><span class="n">R2</span><span class="p">,</span> <span class="n">init_guess</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
        <span class="n">r2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Beta</span><span class="p">(</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">R2p</span><span class="p">)</span>
        <span class="c1"># interpreted as total variance now</span>
        <span class="c1"># it is concentrated around empirical variance</span>
        <span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">LogNormal</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">std</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">)</span>
        <span class="c1"># the global R2</span>
        <span class="c1"># Local R2 / variable importance</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Dirichlet</span><span class="p">(</span><span class="s2">&quot;phi&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
        <span class="c1"># Centered parametrization</span>
        <span class="c1"># Note that we scale the parameters by output std</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;coef_raw&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
        <span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;coef_norm&quot;</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
        <span class="c1"># Parameters on the original data scale</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">Deterministic</span><span class="p">(</span><span class="s2">&quot;coef&quot;</span><span class="p">,</span> <span class="n">beta</span> <span class="o">/</span> <span class="n">scaling</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
        <span class="c1"># now the likelihood</span>
        <span class="n">resid_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span>
        <span class="n">intercept</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="s2">&quot;intercept&quot;</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">std</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
        <span class="n">estimate</span> <span class="o">=</span> <span class="n">Xr</span> <span class="o">@</span> <span class="n">beta</span> <span class="o">+</span> <span class="n">intercept</span>
        <span class="n">nu</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Gamma</span><span class="p">(</span><span class="s2">&quot;nu&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">pm</span><span class="o">.</span><span class="n">StudentT</span><span class="p">(</span><span class="s2">&quot;obs&quot;</span><span class="p">,</span> <span class="n">nu</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">estimate</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="n">resid_sigma</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="n">target</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model_sigma_attached</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">create_non_centered_model_2</span><span class="p">()</span> <span class="k">as</span> <span class="n">model_sigma_attached</span><span class="p">:</span>
    <span class="n">trace2</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;nutpie&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
  <progress value='8000' class='' max='8000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [8000/8000 01:54&lt;00:00  Chains in warmup: 0, Divergences: 0]
</div></div>
</div>
<p>Yet, there is correlation in sigma and <span class="math notranslate nohighlight">\(R^2\)</span></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_pair</span><span class="p">(</span>
    <span class="n">trace2</span><span class="p">,</span>
    <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;R2&quot;</span><span class="p">,</span> <span class="s2">&quot;sigma&quot;</span><span class="p">],</span>
    <span class="n">coords</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="s2">&quot;MedInc&quot;</span><span class="p">),</span>
    <span class="n">divergences</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/posts_2023_r2d2m2_post_31_0.png" class="no-scaled-link" src="../../../_images/posts_2023_r2d2m2_post_31_0.png" style="width: 731px; height: 491px;" />
</div>
</div>
<p>What did the job was:</p>
<ol class="arabic simple">
<li><p>Centered parametrization</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">beta</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">Normal</span><span class="p">(</span><span class="s2">&quot;coef_raw&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">*</span> <span class="p">(</span><span class="n">phi</span> <span class="o">*</span> <span class="n">tau2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">dims</span><span class="o">=</span><span class="s2">&quot;variable&quot;</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Attaching residual sigma to the model and <span class="math notranslate nohighlight">\(R^2\)</span> parametrization</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">sigma</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">LogNormal</span><span class="p">(</span><span class="s2">&quot;sigma&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">std</span><span class="p">),</span> <span class="mf">0.1</span><span class="p">)</span>
<span class="o">...</span>
<span class="c1"># (phi * tau2) ** 0.5</span>
<span class="p">(</span><span class="n">phi</span> <span class="o">*</span> <span class="n">r2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>
<span class="o">...</span>
<span class="n">resid_sigma</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">r2</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">sigma</span>
</pre></div>
</div>
</section>
</section>
<section id="Sparse-solution">
<h3>Sparse solution<a class="headerlink" href="#Sparse-solution" title="Permalink to this heading">#</a></h3>
<p>Now imagine we have some doubtful variables under consideration. We are unsure we should use them, but some of them may be helpful. To create a model under this setting, we need variable importance which are <span class="math notranslate nohighlight">\(\alpha\)</span> in the model parameterization.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">with</span> <span class="n">create_non_centered_model_2</span><span class="p">(</span>
    <span class="n">n_irrelevant</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
    <span class="n">wasted_variables_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">useful_variables_alpha</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<span class="p">)</span> <span class="k">as</span> <span class="n">model_sigma_attached_10</span><span class="p">:</span>
    <span class="n">trace3</span> <span class="o">=</span> <span class="n">pm</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">nuts_sampler</span><span class="o">=</span><span class="s2">&quot;nutpie&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<style>
    /* Turns off some styling */
    progress {
        /* gets rid of default border in Firefox and Opera. */
        border: none;
        /* Needs to be in here for Safari polyfill so background images work as expected. */
        background-size: auto;
    }
    progress:not([value]), progress:not([value])::-webkit-progress-bar {
        background: repeating-linear-gradient(45deg, #7e7e7e, #7e7e7e 10px, #5c5c5c 10px, #5c5c5c 20px);
    }
    .progress-bar-interrupted, .progress-bar-interrupted::-webkit-progress-bar {
        background: #F44336;
    }
</style></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area rendered_html docutils container">
<div>
  <progress value='8000' class='' max='8000' style='width:300px; height:20px; vertical-align: middle;'></progress>
  100.00% [8000/8000 03:39&lt;00:00  Chains in warmup: 0, Divergences: 1]
</div></div>
</div>
<p>The amount of sparsity is incredible. Yet, there are few divergences and I think it can be ignored there.</p>
<p>As authors claim, there are instabilities with low <span class="math notranslate nohighlight">\(\alpha\)</span>, and general recommendation (personal experience) is to exclude non-informative variables and set variable importance <span class="math notranslate nohighlight">\(\alpha\)</span> &gt; 1</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">az</span><span class="o">.</span><span class="n">plot_forest</span><span class="p">(</span><span class="n">trace3</span><span class="p">,</span> <span class="n">var_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;coef_raw&quot;</span><span class="p">],</span> <span class="n">combined</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../_images/posts_2023_r2d2m2_post_36_0.png" class="no-scaled-link" src="../../../_images/posts_2023_r2d2m2_post_36_0.png" style="width: 611px; height: 1131px;" />
</div>
</div>
</section>
</section>
<section id="Conclusion">
<h2>Conclusion<a class="headerlink" href="#Conclusion" title="Permalink to this heading">#</a></h2>
<p>There are few practical advices to use R2D2M2 prior:</p>
<ul class="simple">
<li><p>Use the prior to weight variables that make sense. The sparsity inducing alpha leads to some instabilities (which you may ignore).</p></li>
<li><p>Not always centered parametrization was great in my applications. I recommend trying both.</p></li>
<li><p>Coupling the error term sigma into the model leads to fewer instabilities and more interpretable sigma prior.</p></li>
</ul>
<script type="application/vnd.jupyter.widget-state+json">
{"state": {}, "version_major": 2, "version_minor": 0}
</script></section>
</section>
<hr class="docutils" />
<p>If you have new ideas after reading the notebook,
want to discuss it in more details or want to work with me,
you can always <a class="reference internal" href="../../../contacts.html"><span class="doc">reach me out</span></a>.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3 sd-fade-in-slide-down">
<summary class="sd-summary-title sd-card-header">
Resources<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<ul class="simple">
<li><p class="sd-card-text">Download the <a class="reference download internal" download="" href="../../../_downloads/971a1e91c3b47ee4cdc83ca65fc05a38/post.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">post.ipynb</span></code></a></p></li>
<li><p class="sd-card-text">Download the <a class="reference download internal" download="" href="../../../_downloads/e03c04f53600f5f389c00721ea7e14ae/environment.yml"><code class="xref download docutils literal notranslate"><span class="pre">environment.yml</span></code></a></p></li>
</ul>
</div>
</details>
<div class="section ablog__blog_comments">
  
  


<div class="section ablog__prev-next">
  <span class="ablog__prev">
    
    
    <a href="../../../talks/2022/data-elka/event.html">
      
      <i class="fa fa-arrow-circle-left"></i>
      
      <span>Bayesian AB Testing</span>
    </a>
    
  </span>
  <span class="ablog__spacer">&nbsp;</span>
  <span class="ablog__next">
    
    
    <a href="../../../talks/2023/analyst-days/event.html">
      <span>Bayesian AB Testing</span>
      
      <i class="fa fa-arrow-circle-right" ></i>
      
    </a>
    
  </span>
</div>

  
  
</div>

                </article>
              
              
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Boston-Housing-Data">Boston Housing Data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Non-centered-R2D2M2">Non-centered R2D2M2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Centered-R2D2M2">Centered R2D2M2</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#Combining-residual-and-sigma">Combining residual and sigma</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#Sparse-solution">Sparse solution</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#Conclusion">Conclusion</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../../../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2023, Max Kochurov.
      <br/>
    
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><ul class="navbar-icon-links navbar-nav"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/ferrine/" title="GitHub" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-github"></i></span>
            <label class="sr-only">GitHub</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://www.linkedin.com/in/ferrine/" title="LinkedIn" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-linkedin-in"></i></span>
            <label class="sr-only">LinkedIn</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="mailto:max.kochurov@pymc-labs.io" title="Email" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-solid fa-envelope"></i></span>
            <label class="sr-only">Email</label></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://twitter.com/ferrine96/" title="Twitter" class="nav-link" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><span><i class="fa-brands fa-square-twitter"></i></span>
            <label class="sr-only">Twitter</label></a>
        </li>
</ul></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>